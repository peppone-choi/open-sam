# 삼국지 모의전투 웹게임 백엔드 개발 계획

## 모듈 구조 및 상세 계획

### 1. core
> 게임의 기본적 데이터 및 공통 로직을 포함하는 핵심 모듈

- **상수 및 기본값 관리**
    - 게임 밸런싱을 위한 기본 수치 정의
    - 전투력, 이동속도, 생산량 등 핵심 게임 요소의 기본값 설정

- **열거형(Enum) 정의**
    - 부대 유형(보병, 기병, 궁병 등)
    - 지형 유형(평지, 산악, 숲, 강 등)
    - 건물 유형(성벽, 훈련소, 농장 등)
    - 명령 유형(행군, 공격, 징병, 건설 등)
    - 자원 유형(금, 식량, 목재, 철 등)

- **유틸리티 클래스**
    - 시간 관리(턴 계산, 명령 실행 시간 계산 등)
    - 확률 기반 기능(전투 확률, 이벤트 발생 등)
    - 거리 계산 및 경로 탐색
    - 전투력 계산식

- **설정 관리**
    - 외부 설정 파일 로드(JSON, YAML 등)
    - 환경별 설정 분리(개발, 테스트, 프로덕션)
    - 동적 밸런싱 파라미터 관리

### 2. cron
> 게임 진행을 위한 실시간 처리 모듈

- **명령 처리 시스템**
    - 명령 큐 관리 및 우선순위 처리
    - 명령 실행 결과 계산 및 적용
    - 명령 충돌 해결 로직

- **시뮬레이션 엔진**
    - AI 장수/세력 행동 결정
    - 자원 생산 및 소비 주기적 갱신
    - 인구 변화, 사기 변동 등 자동 진행 요소

- **전투 해결 프로세서**
    - 전투 단계별 처리(접근, 교전, 결과 적용)
    - 진형 및 전술 효과 계산
    - 전투 결과 역사 기록

- **이벤트 생성기**
    - 정기 이벤트(계절 변화, 추수 등)
    - 랜덤 이벤트(반란, 역병, 자연재해 등)
    - 조건부 이벤트(특정 조건 달성 시)

- **스케줄러**
    - 주기적 작업 관리
    - 게임 내 시간 흐름 관리
    - 장기 작업 모니터링

### 3. web
> 웹 인터페이스 및 API 통합 관리

- **RESTful API 컨트롤러**
    - 게임 상태 조회 엔드포인트
    - 유저 명령 접수 엔드포인트
    - 데이터 조회 및 필터링 기능

- **웹소켓 핸들러**
    - 실시간 알림 송신
    - 전투 진행 상황 스트리밍
    - 게임 내 메시지 전송

- **인증 및 보안**
    - 사용자 인증 처리
    - API 접근 제어
    - 세션 관리

- **DTO(Data Transfer Object) 관리**
    - 엔티티와 API 응답 분리
    - 효율적인 데이터 직렬화/역직렬화
    - API 버전 관리

- **API 문서화**
    - Swagger/OpenAPI 통합
    - API 사용 예시 및 설명

### 4. character (장수)
> 게임 내 장수 관련 기능 관리

- **장수 기본 정보 관리**
    - 능력치(무력, 지력, 통솔 등)
    - 특기 및 스킬
    - 경험치 및 레벨

- **장수 상태 관리**
    - 위치 및 이동 상태
    - 건강 상태 및 부상
    - 소속 및 직위

- **장수 간 관계**
    - 충성도 및 의리
    - 상호 관계(친구, 적대, 스승 등)
    - 혈연 관계

- **장수 성장 시스템**
    - 경험치 획득 및 레벨업
    - 능력치 성장 패턴
    - 특기 습득 및 마스터

### 5. faction (세력)
> 게임 내 세력(국가) 관련 기능 관리

- **세력 기본 정보**
    - 세력명 및 상징
    - 지배 영토 및 수도
    - 통치자 및 요직

- **정책 및 전략**
    - 내정 정책(경제, 군사, 문화 등)
    - 외교 정책(우호, 적대, 중립 등)
    - 기술 연구 트리

- **외교 관계**
    - 세력 간 관계 상태
    - 조약 체결 및 관리
    - 전쟁 선포 및 강화

- **세력 통계**
    - 군사력 및 경제력
    - 영토 크기 및 인구
    - 세력 평판 및 영향력

### 6. user (유저)
> 게임 사용자 관련 기능 관리

- **계정 관리**
    - 사용자 정보 및 설정
    - 인증 및 권한 관리
    - 프로필 관리

- **게임 진행 상태**
    - 현재 조종 장수/세력
    - 게임 참여 이력
    - 성취 및 업적

- **알림 설정**
    - 알림 종류 및 우선순위
    - 알림 수신 방법(앱, 이메일 등)
    - 방해 금지 시간대

- **활동 로그**
    - 접속 기록
    - 명령 실행 기록
    - 중요 이벤트 참여 기록

### 7. battle (전투)
> 전투 시스템 관리

- **전투 메커니즘**
    - 전투력 계산 로직
    - 지형 및 날씨 영향
    - 사기 및 피로도 시스템

- **진형 및 전술**
    - 진형 유형 및 효과
    - 전술 구현(매복, 화계, 수공 등)
    - 특수 기동 처리

- **공성전 시스템**
    - 성벽 내구도 및 방어력
    - 공성 무기 및 효과
    - 포위 및 고립 효과

- **전투 결과 처리**
    - 사상자 계산
    - 전공 및 경험치 분배
    - 전리품 획득

### 8. economy (경제)
> 경제 시스템 관리

- **자원 관리**
    - 자원 생산 및 소비
    - 저장량 및 한계
    - 생산시설 효율

- **거래 시스템**
    - 세력 간 거래
    - 시장 가격 변동
    - 무역로 및 운송

- **세금 체계**
    - 세금 징수 및 세율
    - 민심 영향
    - 특별 과세 및 면세

- **경제 정책**
    - 개발 투자
    - 물가 조절
    - 재분배 체계

### 9. place (지역)
> 지역 및 도시 관리

- **지역 특성**
    - 지형 및 자연 환경
    - 기후 및 계절 영향
    - 고유 특산품 및 자원

- **도시 및 시설**
    - 건물 및 시설 관리
    - 도시 성장 및 발전
    - 방어 시설 및 요새화

- **인구 관리**
    - 인구 증감 요인
    - 직업 분포
    - 민심 및 충성도

- **개발 시스템**
    - 토지 개간 및 관개
    - 도로 및 교통망 건설
    - 특수 시설 건설

### 10. command (명령)
> 명령 시스템 관리

- **명령 유형별 처리**
    - 이동 명령(행군, 철수, 수송 등)
    - 전투 명령(공격, 방어, 포위 등)
    - 내정 명령(건설, 징병, 훈련 등)
    - 외교 명령(조약, 선포, 제안 등)

- **명령 큐 관리**
    - 우선순위 설정
    - 명령 지연 및 취소
    - 동시 명령 조율

- **명령 검증**
    - 전제 조건 확인
    - 자원 및 능력 요구사항 검증
    - 충돌 및 무효화 검사

- **명령 실행 로그**
    - 성공/실패 기록
    - 예상치 못한 결과 처리
    - 실행 시간 측정

### 11. unit (부대)
> 군사 부대 관리

- **부대 구성**
    - 병종 및 구성비
    - 장비 및 무기
    - 지휘 체계

- **부대 상태**
    - 전투력 및 사기
    - 보급 및 피로도
    - 경험 및 훈련도

- **이동 및 주둔**
    - 행군 속도 및 제한
    - 보급선 및 군량
    - 주둔지 효과

- **훈련 및 성장**
    - 훈련 방식 및 효과
    - 전투 경험을 통한 성장
    - 특수 기술 습득

### 12. event (이벤트)
> 게임 내 이벤트 시스템 관리

- **이벤트 유형 관리**
    - 자연 이벤트(가뭄, 홍수, 전염병 등)
    - 사회 이벤트(반란, 민심 변화 등)
    - 역사적 이벤트(인물 등장, 특별 사건 등)
    - 시스템 이벤트(게임 규칙 변경, 시즌 전환 등)

- **이벤트 트리거 시스템**
    - 조건부 이벤트 발생 로직
    - 시간 기반 이벤트 스케줄링
    - 확률 기반 랜덤 이벤트 생성

- **이벤트 결과 처리**
    - 일회성 효과 적용
    - 지속 효과 관리
    - 사용자 선택에 따른 분기 처리

- **이벤트 히스토리**
    - 발생 이벤트 기록
    - 이벤트 영향 추적
    - 반복 방지 메커니즘

### 13. notification (알림)
> 게임 내 알림 및 메시지 시스템 관리

- **알림 생성 및 전송**
    - 중요 게임 이벤트 알림
    - 시스템 공지 및 안내
    - 개인화된 알림 생성

- **알림 채널 관리**
    - 인게임 알림
    - 이메일 알림
    - 푸시 알림 (모바일/데스크톱)

- **알림 우선순위**
    - 긴급/중요/일반 알림 구분
    - 사용자 설정 기반 필터링
    - 알림 묶음 및 요약

- **메시지 센터**
    - 받은 알림 보관 및 관리
    - 알림 조회 및 삭제
    - 읽음/안읽음 상태 추적

### 14. diplomacy (외교)
> 세력 간 외교 관계 및 상호작용 관리

- **외교 관계 시스템**
    - 관계 상태 정의 및 변화
    - 외교 점수 및 신뢰도
    - 관계 이력 추적

- **조약 시스템**
    - 조약 유형(동맹, 불가침, 무역 등)
    - 조약 체결 및 파기
    - 조약 이행 및 위반 효과

- **외교 행동**
    - 사신 파견 및 접견
    - 선물 및 뇌물
    - 협박 및 위협
    - 정보 교환

- **외교적 사건**
    - 외교 위기 발생 및 해결
    - 국제 회의 및 중재
    - 제3자 개입 효과

### 15. history (역사)
> 게임 진행 기록 및 역사 관리

- **게임 기록 시스템**
    - 주요 사건 기록
    - 세력 흥망성쇠 추적
    - 인물 업적 및 활동

- **연표 및 연대기**
    - 시간순 사건 정리
    - 주요 전투 및 전쟁 기록
    - 세력 변화 시각화

- **통계 및 분석**
    - 전투 승패 통계
    - 영토 변화 추적
    - 경제 지표 변화
    - 장수 성장 기록

- **역사적 비교**
    - 실제 역사와의 비교
    - 시나리오 재현도
    - 대체 역사 분석

### 16. admin (관리자)
> 게임 관리 및 운영 도구

- **게임 모니터링**
    - 실시간 게임 상태 확인
    - 서버 부하 및 성능 모니터링
    - 사용자 활동 추적

- **게임 밸런싱 도구**
    - 게임 파라미터 조정
    - 세력/장수 능력치 조정
    - 자원 및 경제 조절

- **콘텐츠 관리**
    - 이벤트 생성 및 배포
    - 시나리오 편집 및 관리
    - 신규 장수/아이템 추가

- **사용자 관리**
    - 계정 관리 및 제재
    - 피드백 및 신고 처리
    - 사용자 지원 도구

- **데이터 추출 및 백업**
    - 게임 데이터 백업
    - 통계 데이터 추출
    - 로그 분석 및 리포트

## 기술 스택 및 인프라 계획

### 데이터베이스
- 관계형 데이터베이스(PostgreSQL/MySQL): 핵심 게임 데이터 저장
- Redis: 캐싱 및 실시간 데이터 처리
- 이벤트 저장소: 게임 이벤트 기록 및 재생

### 백엔드 기술
- Spring Boot: 웹 및 서비스 레이어 구현
- JPA/Hibernate: 데이터 접근 레이어
- WebSocket: 실시간 통신
- Spring Security: 인증 및 보안
- Spring Batch: 대규모 데이터 처리 및 주기적 작업

### 배포 및 운영
- Docker: 컨테이너화
- CI/CD 파이프라인
- 모니터링 및 로깅 시스템
- 백업 및 복구 전략

## 개발 로드맵

### 1단계: 핵심 시스템 구축
- core 모듈 개발
- 기본 데이터 모델 설계
- DB 스키마 설계 및 구현

### 2단계: 게임 로직 구현
- 장수 및 세력 시스템
- 경제 및 자원 시스템
- 명령 및 부대 시스템

### 3단계: 전투 및 AI 구현
- 전투 시스템 완성
- AI 행동 패턴 구현
- 이벤트 시스템 구현

### 4단계: 웹 인터페이스 및 API
- REST API 완성
- 웹소켓 통신 구현
- 관리자 도구 개발

### 5단계: 테스트 및 최적화
- 부하 테스트 및 성능 최적화
- 밸런싱 테스트 및 조정
- 보안 감사 및 강화

## 확장 고려사항

### 1. 멀티플레이어 개선
- 동시 접속자 확장성
- 실시간 상호작용 개선
- 길드/연합 시스템

### 2. 콘텐츠 확장
- 시나리오 및 캠페인 모드
- 특별 이벤트 및 시즌
- 역사적 사건 재현

### 3. 사용자 경험 향상
- 튜토리얼 및 가이드
- 성취 및 보상 시스템
- 커스터마이징 옵션

### 4. 분석 및 모니터링
- 게임 데이터 분석 도구
- 플레이어 행동 패턴 분석
- 자동 밸런싱 시스템

# 삼국지 모의전투 웹게임 모듈별 기술 스택

## 프로젝트 공통 기술 스택
- **Java/Kotlin**: 주요 개발 언어 (JDK 17+ 권장)
- **Gradle**: 빌드 및 의존성 관리
- **Spring Boot 3.x**: 기본 프레임워크
- **JUnit 5**: 단위 테스트
- **Mockito**: 테스트를 위한 목킹
- **SLF4J + Logback**: 로깅
- **Git**: 버전 관리

## 모듈별 기술 스택

### core
- **Jackson/Gson**: JSON 처리
- **Apache Commons**: 유틸리티 라이브러리
- **Lombok**: 보일러플레이트 코드 감소
- **YAML/Typesafe Config**: 설정 관리
- **Vavr**: 함수형 프로그래밍 지원

### cron
- **Spring Boot Starter**: 메인 애플리케이션
- **Spring Scheduler**: 스케줄링
- **Quartz**: 복잡한 스케줄링 작업
- **Spring Integration**: 메시지 기반 통합
- **RxJava/Project Reactor**: 반응형 프로그래밍

### web
- **Spring Boot Web**: 웹 애플리케이션 프레임워크
- **Spring WebSocket**: 실시간 통신
- **Spring Security**: 인증 및 보안
- **Spring HATEOAS**: REST API 설계
- **Swagger/SpringDoc OpenAPI**: API 문서화
- **Spring Validation**: 입력 값 검증
- **ModelMapper/MapStruct**: DTO-Entity 매핑

### character
- **Spring Data JPA**: 데이터 접근
- **Hibernate**: ORM
- **QueryDSL**: 타입 안전 쿼리
- **Caffeine**: 메모리 내 캐싱

### faction
- **Spring Data JPA**: 데이터 접근
- **JGraph/GraphStream**: 관계 그래프 처리
- **Apache Commons Math**: 수학적 계산

### user
- **Spring Security**: 인증 및 권한 관리
- **jjwt/Auth0 JWT**: JWT 인증
- **Spring Session**: 세션 관리
- **BCrypt**: 비밀번호 해싱
- **Spring Data JPA**: 데이터 접근

### battle
- **Spring Data JPA**: 데이터 접근
- **Apache Commons Math**: 수학적 계산 및 알고리즘
- **JAXB/Jackson**: XML 처리 (전투 설정용)
- **State Machine**: 전투 상태 관리

### economy
- **Spring Data JPA**: 데이터 접근
- **Apache Commons Math**: 경제 알고리즘 및 계산
- **JodaMoney**: 화폐 및 수량 계산
- **Cache Abstraction**: 성능 최적화

### place
- **Spring Data JPA**: 데이터 접근
- **GeoTools/JTS**: 지리적 계산
- **Apache Commons Math**: 수학적 계산
- **Cache Abstraction**: 성능 최적화

### command
- **Spring Data JPA**: 데이터 접근
- **Spring State Machine**: 명령 상태 관리
- **Spring Integration**: 메시지 기반 통합

### unit
- **Spring Data JPA**: 데이터 접근
- **Apache Commons Math**: 군사 능력 계산
- **Cache Abstraction**: 성능 최적화

### event
- **Spring Events**: 이벤트 발행/구독
- **Spring Integration**: 메시지 기반 통합
- **Spring Data JPA**: 데이터 접근
- **Quartz**: 예약된 이벤트

### notification
- **Spring WebSocket**: 실시간 알림
- **Redis Pub/Sub**: 메시지 브로커
- **Spring Data JPA**: 데이터 접근
- **JavaMail/Spring Mail**: 이메일 알림
- **Firebase Cloud Messaging**: 푸시 알림 (옵션)

### diplomacy
- **Spring Data JPA**: 데이터 접근
- **JGraph/GraphStream**: 관계 그래프 처리
- **State Machine**: 외교 상태 관리

### history
- **Spring Data JPA**: 데이터 접근
- **Spring Batch**: 대량 데이터 처리
- **InfluxDB/TimescaleDB**: 시계열 데이터 (옵션)
- **MongoDB**: 비정형 로그 데이터 (옵션)

### admin
- **Spring Boot Admin**: 애플리케이션 모니터링
- **Spring Security**: 관리자 인증 및 권한
- **Spring Data JPA**: 데이터 접근
- **Actuator**: 애플리케이션 상태 모니터링

## 데이터베이스 및 인프라 스택

### 메인 데이터베이스
- **PostgreSQL/MySQL**: 관계형 데이터베이스 (주요 게임 데이터)
- **Flyway/Liquibase**: 데이터베이스 마이그레이션

### 캐싱 및 임시 데이터
- **Redis**: 세션, 캐시, 실시간 데이터
- **Caffeine**: 애플리케이션 내 메모리 캐싱

### 메시징 & 이벤트
- **Kafka/RabbitMQ**: 이벤트 기반 아키텍처
- **Redis Pub/Sub**: 가벼운 메시징

### 모니터링 & 로깅
- **ELK Stack**: 로깅 및 분석
- **Prometheus + Grafana**: 모니터링 및 알림
- **Spring Actuator**: 애플리케이션 상태 모니터링

### DevOps 도구
- **Docker**: 컨테이너화
- **Docker Compose/Kubernetes**: 컨테이너 오케스트레이션
- **Jenkins/GitHub Actions**: CI/CD
- **Terraform/Ansible**: 인프라 관리

## 모듈 간 의존성 관리

### 의존성 방향 원칙
1. `core` 모듈은 다른 모듈에 의존하지 않음
2. `web` 및 `cron` 모듈은 필요한 도메인 모듈에 의존
3. 도메인 모듈들은 가능한 서로 직접 의존성을 최소화
4. 도메인 간 통신은 이벤트 또는 `core`를 통한 간접 참조

### 예시 의존성 그래프
```
core <-- (거의 모든 모듈이 의존)
cron <-- command, event
web <-- 대부분의 도메인 모듈
character <-- user, battle, unit
faction <-- character, diplomacy, economy
...
```

## 선택적 고려 사항

### 다국어 지원
- **MessageSource**: 다국어 메시지
- **LocaleResolver**: 지역 설정

### 성능 최적화
- **Connection Pooling**: HikariCP
- **JPA 최적화**: 지연 로딩, N+1 문제 방지
- **인덱싱 전략**: 데이터베이스 성능 최적화

### 보안 강화
- **OWASP 보안 헤더**: 보안 헤더 설정
- **Rate Limiting**: API 요청 제한
- **CSRF/XSS 방어**: 웹 보안 취약점 방어